<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Formulario PROS</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0e1a24;color:#e8f0f6;margin:0;padding:20px}
h1{margin-top:0}
input,button{padding:10px;border-radius:6px;border:1px solid #173245;margin:5px 0;width:100%}
button{cursor:pointer;background:#4cc2ff;color:#022433;border:none}
#tabla table{width:100%;border-collapse:collapse;margin-top:15px}
#tabla th,#tabla td{border:1px solid #173245;padding:8px;text-align:left}
#tabla th{background:#0f2230}
pre{background:#0c1c28;padding:10px;border-radius:6px;white-space:pre-wrap}
</style>
</head>
<body>

<h1>Formulario PROS</h1>

<script>
// TU URL ACTUAL (cambiará si vuelves a desplegar):
const API_URL = "https://script.google.com/macros/s/AKfycbyuOOoTvV0Ut1UPYCnSS9cMzVFK0qcXqxa8zADJ66jMTw1EqEQth7Eaw6R7QFnf707t/exec";
</script>

<form id="form">
<label>Nombre</label>
<input id="nombre" required>

<label>Teléfono</label>
<input id="telefono">

<label>Email</label>
<input id="email" type="email">

<label>Servicio</label>
<input id="servicio">

<button type="submit">Guardar en PROS</button>
</form>

<h2>Buscar</h2>
<input id="buscar" placeholder="Escribe algo...">
<button onclick="buscar()">Buscar</button>
<button onclick="listar()">Listar todo</button>

<h2>Resultados</h2>
<div id="tabla"></div>
<pre id="out"></pre>

<script>
async function apiGet(params={}) {
const qs = new URLSearchParams(params).toString();
const url = qs ? `${API_URL}?${qs}` : API_URL;
const res = await fetch(url);
return res.json();
}
async function apiPost(payload={}) {
const res = await fetch(API_URL, {
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(payload)
});
return res.json();
}

document.getElementById("form").addEventListener("submit", async e=>{
e.preventDefault();
const payload = {
nombre: document.getElementById("nombre").value,
telefono: document.getElementById("telefono").value,
email: document.getElementById("email").value,
servicio: document.getElementById("servicio").value
};
const data = await apiPost(payload);
document.getElementById("out").textContent = JSON.stringify(data,null,2);
listar();
});

async function listar(){
const data = await apiGet({action:"list"});
render(data);
}
async function buscar(){
const q = document.getElementById("buscar").value;
const data = await apiGet(q?{q}: {action:"list"});
render(data);
}

function render(res){
document.getElementById("out").textContent = JSON.stringify(res,null,2);
const cont = document.getElementById("tabla");
cont.innerHTML="";
if(!res.success || !res.data || !res.data.length){ cont.textContent="Sin resultados"; return; }
const cols = Object.keys(res.data[0]);
let html = "<table><thead><tr>"+cols.map(c=>`<th>${c}</th>`).join("")+"</tr></thead><tbody>";
res.data.forEach(r=>{
html += "<tr>"+cols.map(c=>`<td>${r[c]??""}</td>`).join("")+"</tr>";
});
html += "</tbody></table>";
cont.innerHTML=html;
}

listar();
</script>

</body>
</html>

